{"version":3,"file":"useAccordion.js","sources":["../../src/components/va-accordion/hooks/useAccordion.ts"],"sourcesContent":["import { computed, inject, onBeforeUnmount, onMounted, provide, Ref, ref, watch, WritableComputedRef } from 'vue'\n\nexport const AccordionServiceKey = Symbol('AccordionService')\n\nexport interface AccordionItemProps {\n  inset?: boolean,\n  popout?: boolean\n}\n\nexport interface AccordionProps extends AccordionItemProps {\n  modelValue: boolean[],\n  multiply: boolean,\n}\n\nexport interface AccordionItem {\n  state: WritableComputedRef<boolean>\n}\n\nexport interface AccordionInject {\n  onItemMounted: (item: AccordionItem) => void,\n  onItemUnmounted: (item: AccordionItem) => void,\n  onItemChanged: (changedItem: AccordionItem) => void,\n  props: Ref<AccordionItemProps>,\n}\n\n/**\n * @param props\n * @param state array of states of all accordion items */\nexport const useAccordion = (props: AccordionProps, state: WritableComputedRef<boolean[]>) => {\n  /** @notice items are reactive because they have reactive `state` inside */\n  let items: AccordionItem[] = []\n\n  const onItemMounted = (item: AccordionItem) => { items.push(item) }\n  const onItemUnmounted = (item: AccordionItem) => { items = items.filter((i) => i !== item) }\n  const onItemChanged = (changedItem: AccordionItem) => {\n    state.value = items\n      .map((item: AccordionItem) => {\n        if (item === changedItem) {\n          return item.state.value\n        }\n\n        if (!props.multiply) {\n          item.state.value = false\n        }\n\n        return item.state.value\n      })\n  }\n\n  provide(AccordionServiceKey, {\n    isInsideAccordion: true,\n    onItemMounted,\n    onItemUnmounted,\n    onItemChanged,\n    props: computed(() => props),\n  })\n\n  const updateItemStates = () => {\n    items.forEach((item: AccordionItem, index: number) => {\n      item.state.value = state.value[index]\n    })\n  }\n\n  onMounted(updateItemStates)\n  watch(state, updateItemStates)\n\n  return { items }\n}\n\n/**\n * Hook used in items that should react on VaAccordion changes\n * @param state shows if accordion item is open\n */\nexport const useAccordionItem = (state: WritableComputedRef<boolean>) => {\n  const accordion = inject<AccordionInject>(AccordionServiceKey, {\n    props: ref({ inset: undefined, popout: undefined }),\n    onItemChanged: () => undefined,\n    onItemMounted: () => undefined,\n    onItemUnmounted: () => undefined,\n  })\n\n  const item = { state }\n\n  onMounted(() => accordion.onItemMounted(item))\n  onBeforeUnmount(() => accordion.onItemUnmounted(item))\n\n  return {\n    accordionProps: accordion.props,\n\n    toggle: () => {\n      /** Toggle collapse value and notify accordion about it */\n      state.value = !state.value\n      accordion.onItemChanged(item)\n    },\n  }\n}\n"],"names":[],"mappings":";;AAEO,MAAM,mBAAmB,GAAG,MAAM,CAAC,kBAAkB,CAAC,CAAA;AAuB7D;;AAEyD;MAC5C,YAAY,GAAG,CAAC,KAAqB,EAAE,KAAqC,KAAI;;IAE3F,IAAI,KAAK,GAAoB,EAAE,CAAA;AAE/B,IAAA,MAAM,aAAa,GAAG,CAAC,IAAmB,KAAO,EAAA,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA,EAAE,CAAA;IACnE,MAAM,eAAe,GAAG,CAAC,IAAmB,KAAO,EAAA,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,IAAI,CAAC,CAAA,EAAE,CAAA;AAC5F,IAAA,MAAM,aAAa,GAAG,CAAC,WAA0B,KAAI;QACnD,KAAK,CAAC,KAAK,GAAG,KAAK;AAChB,aAAA,GAAG,CAAC,CAAC,IAAmB,KAAI;YAC3B,IAAI,IAAI,KAAK,WAAW,EAAE;AACxB,gBAAA,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK,CAAA;AACxB,aAAA;AAED,YAAA,IAAI,CAAC,KAAK,CAAC,QAAQ,EAAE;AACnB,gBAAA,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAA;AACzB,aAAA;AAED,YAAA,OAAO,IAAI,CAAC,KAAK,CAAC,KAAK,CAAA;AACzB,SAAC,CAAC,CAAA;AACN,KAAC,CAAA;IAED,OAAO,CAAC,mBAAmB,EAAE;AAC3B,QAAA,iBAAiB,EAAE,IAAI;QACvB,aAAa;QACb,eAAe;QACf,aAAa;AACb,QAAA,KAAK,EAAE,QAAQ,CAAC,MAAM,KAAK,CAAC;AAC7B,KAAA,CAAC,CAAA;IAEF,MAAM,gBAAgB,GAAG,MAAK;QAC5B,KAAK,CAAC,OAAO,CAAC,CAAC,IAAmB,EAAE,KAAa,KAAI;YACnD,IAAI,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,KAAK,CAAC,KAAK,CAAC,CAAA;AACvC,SAAC,CAAC,CAAA;AACJ,KAAC,CAAA;IAED,SAAS,CAAC,gBAAgB,CAAC,CAAA;AAC3B,IAAA,KAAK,CAAC,KAAK,EAAE,gBAAgB,CAAC,CAAA;IAE9B,OAAO,EAAE,KAAK,EAAE,CAAA;AAClB,EAAC;AAED;;;AAGG;AACU,MAAA,gBAAgB,GAAG,CAAC,KAAmC,KAAI;AACtE,IAAA,MAAM,SAAS,GAAG,MAAM,CAAkB,mBAAmB,EAAE;AAC7D,QAAA,KAAK,EAAE,GAAG,CAAC,EAAE,KAAK,EAAE,SAAS,EAAE,MAAM,EAAE,SAAS,EAAE,CAAC;AACnD,QAAA,aAAa,EAAE,MAAM,SAAS;AAC9B,QAAA,aAAa,EAAE,MAAM,SAAS;AAC9B,QAAA,eAAe,EAAE,MAAM,SAAS;AACjC,KAAA,CAAC,CAAA;AAEF,IAAA,MAAM,IAAI,GAAG,EAAE,KAAK,EAAE,CAAA;IAEtB,SAAS,CAAC,MAAM,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC,CAAA;IAC9C,eAAe,CAAC,MAAM,SAAS,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAA;IAEtD,OAAO;QACL,cAAc,EAAE,SAAS,CAAC,KAAK;QAE/B,MAAM,EAAE,MAAK;;AAEX,YAAA,KAAK,CAAC,KAAK,GAAG,CAAC,KAAK,CAAC,KAAK,CAAA;AAC1B,YAAA,SAAS,CAAC,aAAa,CAAC,IAAI,CAAC,CAAA;SAC9B;KACF,CAAA;AACH;;;;"}