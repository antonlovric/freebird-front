{"version":3,"file":"useSelectable.js","sources":["../../src/composables/useSelectable.ts"],"sourcesContent":["import { PropType, computed, SetupContext, ShallowRef, ExtractPropTypes } from 'vue'\n\nimport { useStateful, useStatefulProps, StatefulProps } from './useStateful'\nimport { useLoadingProps, LoadingProps } from './useLoading'\nimport { useValidation, useValidationProps, ValidationProps, useValidationEmits } from './useValidation'\nimport { useFocus } from './useFocus'\n\nexport type SelectableProps<V = any> = StatefulProps<V> & LoadingProps & ExtractPropTypes<ValidationProps<V>> & {\n  arrayValue: V | null,\n  label: string,\n  leftLabel: boolean,\n  trueValue: boolean,\n  falseValue: boolean,\n  indeterminate: boolean,\n  indeterminateValue: V | null,\n  disabled: boolean,\n  readonly: boolean,\n}\n\nexport type Elements = {\n  input: ShallowRef<HTMLElement | undefined>,\n  label: ShallowRef<HTMLElement | undefined>,\n  container: ShallowRef<HTMLElement | undefined>,\n}\n\nexport const useSelectableProps = {\n  ...useStatefulProps,\n  ...useLoadingProps,\n  ...useValidationProps,\n  arrayValue: { type: null as any as PropType<unknown>, default: null },\n  label: { type: String, default: '' },\n  leftLabel: { type: Boolean, default: false },\n  trueValue: { type: null as any as PropType<unknown>, default: true },\n  falseValue: { type: null as any as PropType<unknown>, default: false },\n  indeterminate: { type: Boolean, default: false },\n  indeterminateValue: { type: null as any as PropType<unknown>, default: null },\n  disabled: { type: Boolean, default: false },\n  readonly: { type: Boolean, default: false },\n}\n\nexport const useSelectableEmits = [...useValidationEmits, 'update:modelValue', 'focus', 'blur']\n\nconst checkDuplicates = (props: SelectableProps) => {\n  // Just validating state values.\n  const values: unknown[] = [props.falseValue, props.trueValue]\n\n  if (props.indeterminate) {\n    values.push(props.indeterminateValue)\n  }\n\n  const hasDuplicates = new Set(values).size !== values.length\n\n  if (hasDuplicates) {\n    throw new Error('falseValue, trueValue, indeterminateValue props should have strictly different values, which is not the case.')\n  }\n}\n\nexport const useSelectable = (\n  props: SelectableProps,\n  emit: SetupContext['emit'],\n  { input, label, container }: Elements,\n) => {\n  checkDuplicates(props)\n\n  /** @public */\n  const reset = () => emit('update:modelValue', false)\n  const focus = () => input.value?.focus()\n\n  const { computedError, computedErrorMessages, validate } = useValidation(props, emit, reset, focus)\n  const { valueComputed } = useStateful(props, emit)\n  const { isFocused } = useFocus()\n\n  const isElementRelated = (element: HTMLElement | undefined) => {\n    return !!element && [label.value, container.value].includes(element)\n  }\n  const onBlur = (event: FocusEvent) => {\n    if ((input.value === event.target) && !isElementRelated(event.relatedTarget as HTMLElement)) {\n      isFocused.value = false\n      computedError.value = false\n      validate()\n      emit('blur', event)\n    }\n  }\n  const onFocus = (event: FocusEvent) => {\n    isFocused.value = true\n    emit('focus', event)\n  }\n\n  const isIndeterminate = computed(() => !!props.indeterminate && valueComputed.value === props.indeterminateValue)\n  const modelIsArray = computed(() => props.arrayValue !== null)\n  const isChecked = computed(() => {\n    if (modelIsArray.value) {\n      return (props.modelValue as unknown[])?.includes(props.arrayValue)\n    }\n\n    return valueComputed.value === props.trueValue\n  })\n  const toggleSelection = () => {\n    if (props.readonly || props.disabled || props.loading) {\n      return\n    }\n\n    // For array access we pretend computedValue does not exist and use modelValue + emit input directly.\n    if (modelIsArray.value) {\n      if (!props.modelValue) {\n        emit('update:modelValue', [props.arrayValue])\n      } else if (!Array.isArray(props.modelValue)) {\n        emit('update:modelValue', props.modelValue === props.arrayValue ? [] : [props.modelValue, props.arrayValue])\n      } else if (props.modelValue.includes(props.arrayValue)) {\n        emit('update:modelValue', props.modelValue.filter((option) => option !== props.arrayValue))\n      } else {\n        emit('update:modelValue', props.modelValue.concat(props.arrayValue))\n      }\n      return\n    }\n\n    if (props.indeterminate) {\n      if (isIndeterminate.value) {\n        valueComputed.value = props.trueValue\n      } else if (isChecked.value) {\n        valueComputed.value = props.falseValue\n      } else {\n        // unchecked\n        valueComputed.value = props.indeterminateValue\n      }\n      return\n    }\n\n    if (isChecked.value) {\n      valueComputed.value = props.falseValue\n    } else {\n      valueComputed.value = props.trueValue\n    }\n  }\n\n  return {\n    isChecked,\n    isIndeterminate,\n    onBlur,\n    onFocus,\n    toggleSelection,\n    reset,\n    focus,\n    computedError,\n    computedErrorMessages,\n  }\n}\n"],"names":[],"mappings":"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"}