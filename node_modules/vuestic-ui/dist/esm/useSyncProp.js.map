{"version":3,"file":"useSyncProp.js","sources":["../../src/composables/useSyncProp.ts"],"sourcesContent":["import { ref, computed, watch, UnwrapRef } from 'vue'\n\n/**\n * Returns computed that emits update:${propName} on edit.\n *\n * @tutorial\n * ```\n * const [prop] = useSyncProp('name', props, emit)\n *\n * prop.value = 'New name'\n *\n * $nextTick(() => console.log(prop.value)) // 'New name'\n * ```\n *\n * @notice\n * Be careful, that property is not updating in current render\n * cycle. Be sure to use $nextTick if you need to use this property after change.\n */\nexport function useSyncProp<\n  T,\n  PropName extends string,\n  Props extends { [key in PropName]?: T },\n  Emit extends (event: any, newValue: Props[PropName]) => any,\n  DefaultValue extends Props[PropName],\n  ReturnValue extends DefaultValue extends undefined ? Props[PropName] : DefaultValue\n> (propName: PropName, props: Props, emit: Emit, defaultValue?: NonNullable<DefaultValue>) {\n  if (defaultValue === undefined) {\n    return [\n      computed<ReturnValue>({\n        set (value: ReturnValue) {\n          emit(`update:${propName}`, value)\n        },\n        get () {\n          return props[propName] as ReturnValue\n        },\n      }),\n    ]\n  }\n\n  const currentValue = props[propName]\n  const statefulValue = ref(currentValue === undefined ? defaultValue : currentValue)\n\n  watch(() => props[propName], (newVal) => {\n    if (newVal === undefined) { return }\n\n    statefulValue.value = newVal as UnwrapRef<ReturnValue>\n  })\n\n  return [\n    computed<ReturnValue>({\n      set (value: ReturnValue) {\n        statefulValue.value = value as UnwrapRef<ReturnValue>\n        emit(`update:${propName}`, value)\n      },\n      get (): ReturnValue {\n        return (props[propName] === undefined ? statefulValue.value : props[propName]) as ReturnValue\n      },\n    }),\n  ]\n}\n"],"names":[],"mappings":";;AAEA;;;;;;;;;;;;;;;AAeG;AACG,SAAU,WAAW,CAOxB,QAAkB,EAAE,KAAY,EAAE,IAAU,EAAE,YAAwC,EAAA;IACvF,IAAI,YAAY,KAAK,SAAS,EAAE;QAC9B,OAAO;AACL,YAAA,QAAQ,CAAc;AACpB,gBAAA,GAAG,CAAE,KAAkB,EAAA;AACrB,oBAAA,IAAI,CAAC,CAAU,OAAA,EAAA,QAAQ,EAAE,EAAE,KAAK,CAAC,CAAA;iBAClC;gBACD,GAAG,GAAA;AACD,oBAAA,OAAO,KAAK,CAAC,QAAQ,CAAgB,CAAA;iBACtC;aACF,CAAC;SACH,CAAA;AACF,KAAA;AAED,IAAA,MAAM,YAAY,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAA;AACpC,IAAA,MAAM,aAAa,GAAG,GAAG,CAAC,YAAY,KAAK,SAAS,GAAG,YAAY,GAAG,YAAY,CAAC,CAAA;AAEnF,IAAA,KAAK,CAAC,MAAM,KAAK,CAAC,QAAQ,CAAC,EAAE,CAAC,MAAM,KAAI;QACtC,IAAI,MAAM,KAAK,SAAS,EAAE;YAAE,OAAM;AAAE,SAAA;AAEpC,QAAA,aAAa,CAAC,KAAK,GAAG,MAAgC,CAAA;AACxD,KAAC,CAAC,CAAA;IAEF,OAAO;AACL,QAAA,QAAQ,CAAc;AACpB,YAAA,GAAG,CAAE,KAAkB,EAAA;AACrB,gBAAA,aAAa,CAAC,KAAK,GAAG,KAA+B,CAAA;AACrD,gBAAA,IAAI,CAAC,CAAU,OAAA,EAAA,QAAQ,EAAE,EAAE,KAAK,CAAC,CAAA;aAClC;YACD,GAAG,GAAA;gBACD,QAAQ,KAAK,CAAC,QAAQ,CAAC,KAAK,SAAS,GAAG,aAAa,CAAC,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,EAAgB;aAC9F;SACF,CAAC;KACH,CAAA;AACH;;;;"}