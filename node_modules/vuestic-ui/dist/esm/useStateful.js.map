{"version":3,"file":"useStateful.js","sources":["../../src/composables/useStateful.ts"],"sourcesContent":["import { ref, computed, PropType, Ref, watch } from 'vue'\n\nexport type StatefulProps<T> = {\n  stateful: boolean\n  modelValue: T\n}\n\n/**\n * You could add these props to any component by destructuring them inside props option.\n * @example\n * props: { ...useStatefulProps, componentsOwnProp, etc. }\n * It's better to add props at the beginning, to make sure that Component own props will be used instead in case of collision\n */\nexport const useStatefulProps = {\n  stateful: { type: Boolean as PropType<boolean>, default: false },\n  modelValue: { type: undefined as any },\n}\n\nexport const useStatefulEmits = ['update:modelValue']\n\n/**\n * Returns `valueComputed` that is proxy for `modelValue`\n * if `stateful` prop is `false`\n * Record<any, any> & Record<'modelValue', T>\n */\nexport function useStateful<T, D extends T = T> (\n  props: StatefulProps<T>,\n  emit: (event: 'update:modelValue', newValue: T) => void,\n  defaultValue?: D,\n) {\n  const valueState = ref(defaultValue === undefined ? props.modelValue : defaultValue) as Ref<T>\n  let unwatchModelValue: Function\n\n  const watchModelValue = () => {\n    unwatchModelValue = watch(() => props.modelValue, (modelValue) => {\n      valueState.value = modelValue\n    })\n  }\n\n  watch(() => props.stateful, (stateful: boolean) => {\n    stateful ? watchModelValue() : unwatchModelValue?.()\n  }, { immediate: true })\n\n  const valueComputed = computed<T>({\n    get () {\n      if (props.stateful) {\n        return valueState.value\n      }\n      return props.modelValue\n    },\n    set (value: T) {\n      if (props.stateful) {\n        valueState.value = value\n      }\n      emit('update:modelValue', value)\n    },\n  })\n\n  return { valueComputed }\n}\n"],"names":[],"mappings":";;AAOA;;;;;AAKG;AACU,MAAA,gBAAgB,GAAG;IAC9B,QAAQ,EAAE,EAAE,IAAI,EAAE,OAA4B,EAAE,OAAO,EAAE,KAAK,EAAE;AAChE,IAAA,UAAU,EAAE,EAAE,IAAI,EAAE,SAAgB,EAAE;EACvC;AAEY,MAAA,gBAAgB,GAAG,CAAC,mBAAmB,EAAC;AAErD;;;;AAIG;SACa,WAAW,CACzB,KAAuB,EACvB,IAAuD,EACvD,YAAgB,EAAA;AAEhB,IAAA,MAAM,UAAU,GAAG,GAAG,CAAC,YAAY,KAAK,SAAS,GAAG,KAAK,CAAC,UAAU,GAAG,YAAY,CAAW,CAAA;AAC9F,IAAA,IAAI,iBAA2B,CAAA;IAE/B,MAAM,eAAe,GAAG,MAAK;AAC3B,QAAA,iBAAiB,GAAG,KAAK,CAAC,MAAM,KAAK,CAAC,UAAU,EAAE,CAAC,UAAU,KAAI;AAC/D,YAAA,UAAU,CAAC,KAAK,GAAG,UAAU,CAAA;AAC/B,SAAC,CAAC,CAAA;AACJ,KAAC,CAAA;IAED,KAAK,CAAC,MAAM,KAAK,CAAC,QAAQ,EAAE,CAAC,QAAiB,KAAI;AAChD,QAAA,QAAQ,GAAG,eAAe,EAAE,GAAG,iBAAiB,KAAjB,IAAA,IAAA,iBAAiB,KAAjB,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,iBAAiB,EAAI,CAAA;AACtD,KAAC,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAA;IAEvB,MAAM,aAAa,GAAG,QAAQ,CAAI;QAChC,GAAG,GAAA;YACD,IAAI,KAAK,CAAC,QAAQ,EAAE;gBAClB,OAAO,UAAU,CAAC,KAAK,CAAA;AACxB,aAAA;YACD,OAAO,KAAK,CAAC,UAAU,CAAA;SACxB;AACD,QAAA,GAAG,CAAE,KAAQ,EAAA;YACX,IAAI,KAAK,CAAC,QAAQ,EAAE;AAClB,gBAAA,UAAU,CAAC,KAAK,GAAG,KAAK,CAAA;AACzB,aAAA;AACD,YAAA,IAAI,CAAC,mBAAmB,EAAE,KAAK,CAAC,CAAA;SACjC;AACF,KAAA,CAAC,CAAA;IAEF,OAAO,EAAE,aAAa,EAAE,CAAA;AAC1B;;;;"}