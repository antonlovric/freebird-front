import{defineComponent as e,shallowRef as t,ref as o,computed as s,onMounted as n,resolveComponent as a,openBlock as l,createBlock as r,Transition as i,withCtx as c,withDirectives as u,createElementVNode as p,normalizeClass as d,normalizeStyle as f,createElementBlock as m,toDisplayString as v,createCommentVNode as C,vShow as g,createVNode as y,withModifiers as T,withKeys as h,getCurrentInstance as b,render as x}from"vue";import{a as k}from"./ssr-utils.mjs";import{w as I}from"./withConfigTransport.mjs";import"./global-config.mjs";import"./usePopover.mjs";import"./global-utils.mjs";import{u as _}from"./useColors.mjs";import{u as $}from"./useTextColor.mjs";import{s as S}from"./VaIcon.mjs";const j=e({name:"VaToastRenderer",props:{render:{type:Function,required:!0}},setup:e=>()=>e.render()});var w=e({name:"VaToast",components:{VaIcon:S,VaToastRenderer:j},emits:["on-click","on-close"],props:{title:{type:String,default:""},offsetY:{type:Number,default:16},offsetX:{type:Number,default:16},message:{type:[String,Function],default:""},dangerouslyUseHtmlString:{type:Boolean,default:!1},icon:{type:String,default:"close"},customClass:{type:String,default:""},duration:{type:Number,default:5e3},color:{type:String,default:""},closeable:{type:Boolean,default:!0},onClose:{type:Function},onClick:{type:Function},multiLine:{type:Boolean,default:!1},position:{type:String,default:"top-right",validator:e=>["top-right","top-left","bottom-right","bottom-left"].includes(e)},render:{type:Function}},setup(e,{emit:a}){const l=t(),{getColor:r}=_(),{textColorComputed:i}=$(),c=o(!1),u=s((()=>e.position.includes("right")?"right":"left")),p=s((()=>e.position.includes("top")?"top":"bottom")),d=s((()=>[e.customClass,e.multiLine?"va-toast--multiline":""])),f=s((()=>({[p.value]:`${e.offsetY}px`,[u.value]:`${e.offsetX}px`,backgroundColor:r(e.color),color:i.value}))),m=s((()=>"function"==typeof e.message?e.message():e.message)),destroyElement=()=>{var e,t;null===(e=l.value)||void 0===e||e.removeEventListener("transitionend",destroyElement),null===(t=l.value)||void 0===t||t.remove()},onToastClose=()=>{var t;c.value=!1,null===(t=l.value)||void 0===t||t.addEventListener("transitionend",destroyElement),"function"==typeof e.onClose?e.onClose():a("on-close")},v=(()=>{let e;return{start:(...t)=>(e=window.setTimeout(...t),e),clear:()=>e&&window.clearTimeout(e)}})(),C=v.clear,startTimer=()=>{e.duration>0&&v.start((()=>c.value&&onToastClose()),e.duration)};return n((()=>{c.value=!0,startTimer()})),{visible:c,toastClasses:d,toastStyles:f,computedMessage:m,onToastClick:()=>{"function"==typeof e.onClick?e.onClick():a("on-click")},onToastClose:onToastClose,startTimer:startTimer,clearTimer:C}}});const V=["role"],E={class:"va-toast__group"},H=["textContent"],M={class:"va-toast__content"},L=["innerHTML"],N=["textContent"],X={key:1,class:"va-toast__content"};w.render=function render(e,t,o,s,n,b){const x=a("VaToastRenderer"),k=a("va-icon");return l(),r(i,{name:"va-toast-fade"},{default:c((()=>[u(p("div",{ref:"rootElement",role:e.$props.closeable?"alertdialog":"alert",class:d(["va-toast",e.toastClasses]),style:f(e.toastStyles),onMouseenter:t[0]||(t[0]=(...t)=>e.clearTimer&&e.clearTimer(...t)),onMouseleave:t[1]||(t[1]=(...t)=>e.startTimer&&e.startTimer(...t)),onClick:t[2]||(t[2]=(...t)=>e.onToastClick&&e.onToastClick(...t))},[p("div",E,[e.$props.title?(l(),m("h2",{key:0,class:"va-toast__title",textContent:v(e.$props.title)},null,8,H)):C("v-if",!0),u(p("div",M,[e.$props.dangerouslyUseHtmlString?(l(),m("div",{key:0,innerHTML:e.computedMessage},null,8,L)):(l(),m("p",{key:1,textContent:v(e.computedMessage)},null,8,N))],512),[[g,e.$props.message]]),e.$props.render?(l(),m("div",X,[y(x,{render:e.$props.render},null,8,["render"])])):C("v-if",!0),e.$props.closeable?(l(),r(k,{key:2,class:"va-toast__close-icon",role:"button","aria-label":"close toast","aria-hidden":"false",tabindex:"0",size:"small",name:e.$props.icon,onClick:T(e.onToastClose,["stop"]),onKeydown:h(T(e.onToastClose,["stop"]),["enter"])},null,8,["name","onClick","onKeydown"])):C("v-if",!0)])],46,V),[[g,e.visible]])])),_:1})},w.__file="src/components/va-toast/VaToast.vue";const useToast=()=>{var e;const t=null===(e=b())||void 0===e?void 0:e.appContext,o=[];return{init:e=>{const s=createToastInstance(e,t);return s&&o.push(s),s},close:e=>closeById(e),closeAll:(e=!1)=>closeAllNotifications(e?void 0:t),closeAllCreatedInThisHook:()=>{o.forEach((e=>closeById(e)))}}},Y=I(w);let F=1;k().vaToastInstances=[];const getNodeProps=e=>{var t;return(null===(t=e.component)||void 0===t?void 0:t.props)||{}},closeNotification=(e,t)=>{var o;if(!e)return;if(!k().vaToastInstances.length)return void(F=1);const s=k().vaToastInstances.findIndex((t=>t===e));if(s<0)return;const n=getNodeProps(e),{offsetX:a,offsetY:l,position:r}=n,i=null===(o=e.el)||void 0===o?void 0:o.offsetHeight;t(),k().vaToastInstances=k().vaToastInstances.reduce(((t,o,n)=>{if(o===e)return t;if(o.component){const{offsetX:e,offsetY:t,position:c}=getNodeProps(o);if(n>s&&a===e&&l===t&&r===c&&o.el&&i){const[e,t]=o.el.style.transform.match(/[\d-]+(?=px)/g),s=((e,t,o)=>{const s=o.includes("bottom")?-1:1;return parseInt(e,10)-(t+5)*s})(t,i,c);o.el.style.transform=`translate(0, ${s}px)`}}return[...t,o]}),[]),k().vaToastInstances.length||(F=1)},mount=(e,{props:t,children:o,element:s,appContext:n}={})=>{let a,l=s;return a=y(e,{...t,onClose:()=>{closeNotification(a,(()=>((e,t)=>{e&&(x(null,e),e.remove()),e=null})(l))),(null==t?void 0:t.onClose)&&t.onClose()}},o),n&&(a.appContext=n),l?x(a,l):"undefined"!=typeof document&&x(a,l=document.createElement("div")),{vNode:a,el:l}},closeAllNotifications=e=>{k().vaToastInstances.length?k().vaToastInstances.forEach((t=>{e&&t.appContext!==e||getNodeProps(t).onClose()})):F=1},closeById=e=>{const t=k().vaToastInstances.find((t=>{var o;return(null===(o=t.el)||void 0===o?void 0:o.id)===e}));if(t){getNodeProps(t).onClose()}},createToastInstance=(e,t)=>{const{vNode:o,el:s}=mount(Y,{appContext:t,props:(n=e,"string"==typeof n?{message:n}:n)});var n;const a=getNodeProps(o);if(s&&o.el&&a){document.body.appendChild(s.childNodes[0]);const{offsetX:e,offsetY:t,position:n}=a;o.el.style.display="flex",o.el.id="notification_"+F;let l=0;return k().vaToastInstances.filter((o=>{const{offsetX:s,offsetY:a,position:l}=getNodeProps(o);return s===e&&a===t&&n===l})).forEach((e=>{l+=((e,t)=>{if(e.el){const o=t.includes("bottom")?-1:1;return(e.el.offsetHeight+5)*o}return 0})(e,n)})),o.el.style.transform=`translate(0, ${l}px)`,F+=1,k().vaToastInstances.push(o),o.el.id}return null};export{Y as V,closeById as a,closeAllNotifications as b,createToastInstance as c,useToast as u};
//# sourceMappingURL=toast.mjs.map
