import{w as e}from"./withConfigTransport.mjs";import{onMounted as r,onBeforeUnmount as l,defineComponent as o,shallowRef as t,ref as s,computed as i,watch as a,resolveComponent as n,openBlock as u,createBlock as v,resolveDynamicComponent as c,normalizeClass as m,withCtx as d,renderSlot as p,createElementVNode as f,createVNode as g,createCommentVNode as b}from"vue";import{d as h}from"./debounce.mjs";import{s as j}from"./utils.mjs";import"./global-config.mjs";import"./usePopover.mjs";import"./global-utils.mjs";import{u as y}from"./useColors.mjs";import{VaProgressCircle as S}from"./index43.mjs";import"./VaConfig.mjs";import"./toNumber.mjs";import"./isSymbol.mjs";import"./global-properties.mjs";import"./ssr-utils.mjs";import"colortranslator";import"./clamp.mjs";import"./useSize.mjs";var _=o({name:"VaInfiniteScroll",components:{VaProgressCircle:S},props:{load:{type:Function,required:!0},offset:{type:Number,default:500},reverse:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},scrollTarget:{type:[String,Object],default:void 0},debounce:{type:Number,default:100},tag:{type:String,default:"div"}},emits:["onload","onerror"],setup(e,{emit:o}){const n=t(),u=t(),v=s(!1),c=s(!1),m=s(!1),d=s(),p=s(0),f=s(0),g=i((()=>{var r;let l;return l="string"==typeof e.scrollTarget?document.querySelector(e.scrollTarget):e.scrollTarget||(null===(r=n.value)||void 0===r?void 0:r.parentElement),l||document.body})),{addScrollListener:b,removeScrollListener:S}=((e,o,t)=>{const addScrollListener=()=>{var e;null===(e=o.value)||void 0===e||e.addEventListener("scroll",t.value,{passive:!0})},removeScrollListener=()=>{var e;null===(e=o.value)||void 0===e||e.removeEventListener("scroll",t.value)};return r((()=>{o.value&&(o.value.style.overflowY="scroll",e.reverse&&(o.value.scrollTop=o.value.scrollHeight),addScrollListener())})),l(removeScrollListener),{addScrollListener:addScrollListener,removeScrollListener:removeScrollListener}})(e,g,d),{getColor:_}=y(),C=i((()=>c.value?_("danger"):_("primary"))),T=i((()=>{var e;return(null===(e=u.value)||void 0===e?void 0:e.offsetHeight)||0})),H=i((()=>e.offset+T.value)),stop=()=>{e.disabled||(v.value=!1,S())},resume=()=>{e.disabled||b()},onLoad=()=>{const{scrollTop:r,scrollHeight:l,clientHeight:o}=g.value;p.value=l-r;const t=r-f.value;if(f.value=r,e.disabled||c.value||v.value)return;if(m.value)return void(m.value=!1);if(e.reverse&&t>0||!e.reverse&&t<0)return;(e.reverse?r:l-r-o)>H.value||(v.value=!0,e.load().then(finishLoading).catch(onError))},forceSetScrollTopToTarget=e=>{m.value=!0,g.value.scrollTop=e},updateTargetElementScrollTop=()=>{const{scrollTop:r,scrollHeight:l,clientHeight:o}=g.value;if(e.reverse){const e=l-r<p.value,o=r>=T.value;if(e&&o)return;l-p.value>T.value?forceSetScrollTopToTarget(l-p.value):forceSetScrollTopToTarget(T.value)}if(!e.reverse){!(l-r-o>=T.value)&&forceSetScrollTopToTarget(l-o-T.value)}},finishLoading=()=>{updateTargetElementScrollTop(),v.value=!1,o("onload")},stopErrorDisplay=()=>{updateTargetElementScrollTop(),m.value=!1,c.value=!1,v.value=!1,o("onerror")},onError=()=>{stop(),c.value=!0,j(1200).then(stopErrorDisplay).then(resume)};return a((()=>e.debounce),(e=>{d.value=h(onLoad,e)}),{immediate:!0}),a((()=>e.disabled),(e=>{e?stop():resume()})),{element:n,spinnerSlotContainer:u,spinnerColor:C,fetching:v}}});const C={class:"va-infinite-scroll__spinner__default"};_.render=function render(e,r,l,o,t,s){const i=n("va-progress-circle");return u(),v(c(e.$props.tag),{ref:"element",role:"feed",class:m(["va-infinite-scroll",{"va-infinite-scroll--reversed":e.$props.reverse}]),"aria-busy":e.fetching},{default:d((()=>[p(e.$slots,"default"),f("div",{ref:"spinnerSlotContainer",class:m(["va-infinite-scroll__spinner",{"va-infinite-scroll__spinner--invisible":!e.fetching}])},[e.$props.disabled?b("v-if",!0):p(e.$slots,"loading",{key:0},(()=>[f("div",C,[g(i,{size:"small",thickness:.15,color:e.spinnerColor,indeterminate:""},null,8,["thickness","color"])])]))],2)])),_:3},8,["class","aria-busy"])},_.__file="src/components/va-infinite-scroll/VaInfiniteScroll.vue";const T=e(_);export{T as VaInfiniteScroll};
//# sourceMappingURL=index33.mjs.map
