import{_ as t,i as e,b as n,d as r,e as a,f as o,g as i,h as u,j as l,k as s,l as c}from"./global-config.mjs";import{i as f}from"./isSymbol.mjs";import{ref as h,onMounted as v,onBeforeUnmount as m,watch as p,computed as g,unref as d}from"vue";import{i as y}from"./ssr-utils.mjs";var b=function arrayMap$1(t,e){for(var n=-1,r=null==t?0:t.length,a=Array(r);++n<r;)a[n]=e(t[n],n,t);return a},$=b,x=e,w=f,j=t?t.prototype:void 0,R=j?j.toString:void 0;var C=function baseToString$1(t){if("string"==typeof t)return t;if(x(t))return $(t,baseToString$1)+"";if(w(t))return R?R.call(t):"";var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},S=C;var k=function toString$1(t){return null==t?"":S(t)};const A=["x","y","width","height","top","left","right","bottom"],useDomRect=t=>{const e=h(null);let n={};return(t=>{let e=-1;const observe=()=>{e=requestAnimationFrame(observe),t()};v((()=>{observe()})),m((()=>{cancelAnimationFrame(e)}))})((()=>{if(!t.value)return;const r=t.value.getBoundingClientRect();((t,e)=>{for(let n=0;n<A.length;n++)if(t[A[n]]!==e[A[n]])return!1;return!0})(r,n)||(e.value=r),n=r})),p(t,(t=>{e.value=t?t.getBoundingClientRect():null})),{domRect:e}};var M=e,z=f,_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,F=/^\w*$/;var O=function isKey$1(t,e){if(M(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!z(t))||(F.test(t)||!_.test(t)||null!=e&&t in Object(e))},P=n;function memoize$1(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError("Expected a function");var memoized=function(){var n=arguments,r=e?e.apply(this,n):n[0],a=memoized.cache;if(a.has(r))return a.get(r);var o=t.apply(this,n);return memoized.cache=a.set(r,o)||a,o};return memoized.cache=new(memoize$1.Cache||P),memoized}memoize$1.Cache=P;var B=memoize$1;var E=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,I=/\\(\\)?/g,T=function memoizeCapped$1(t){var e=B(t,(function(t){return 500===n.size&&n.clear(),t})),n=e.cache;return e}((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(E,(function(t,n,r,a){e.push(r?a.replace(I,"$1"):n||t)})),e})),q=e,D=O,K=T,W=k;var G=function castPath$4(t,e){return q(t)?t:D(t,e)?[t]:K(W(t))},H=f;var J=function toKey$3(t){if("string"==typeof t||H(t))return t;var e=t+"";return"0"==e&&1/t==-Infinity?"-0":e},L=G,N=J;var Q=function baseGet$1(t,e){for(var n=0,r=(e=L(e,t)).length;null!=t&&n<r;)t=t[N(e[n++])];return n&&n==r?t:void 0},U=r,V=G,X=a,Y=o,Z=J;var tt=Q,et=function baseSet$1(t,e,n,r){if(!Y(t))return t;for(var a=-1,o=(e=V(e,t)).length,i=o-1,u=t;null!=u&&++a<o;){var l=Z(e[a]),s=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return t;if(a!=i){var c=u[l];void 0===(s=r?r(c,l,u):void 0)&&(s=Y(c)?c:X(e[a+1])?[]:{})}U(u,l,s),u=u[l]}return t},nt=G;var rt=G,at=i,ot=e,it=a,ut=u,lt=J;var st=function baseHasIn$1(t,e){return null!=t&&e in Object(t)},ct=function hasPath$1(t,e,n){for(var r=-1,a=(e=rt(e,t)).length,o=!1;++r<a;){var i=lt(e[r]);if(!(o=null!=t&&n(t,i)))break;t=t[i]}return o||++r!=a?o:!!(a=null==t?0:t.length)&&ut(a)&&it(i,a)&&(ot(t)||at(t))};var ft=function basePickBy$1(t,e,n){for(var r=-1,a=e.length,o={};++r<a;){var i=e[r],u=tt(t,i);n(u,i)&&et(o,nt(i,t),u)}return o},ht=function hasIn$1(t,e){return null!=t&&ct(t,e,st)};var vt=function basePick$1(t,e){return ft(t,e,(function(e,n){return ht(t,n)}))},mt=i,pt=e,gt=t?t.isConcatSpreadable:void 0;var dt=l,yt=function isFlattenable$1(t){return pt(t)||mt(t)||!!(gt&&t&&t[gt])};var bt=function baseFlatten$1(t,e,n,r,a){var o=-1,i=t.length;for(n||(n=yt),a||(a=[]);++o<i;){var u=t[o];e>0&&n(u)?e>1?baseFlatten$1(u,e-1,n,r,a):dt(a,u):r||(a[a.length]=u)}return a},$t=bt;var xt=function flatten$1(t){return(null==t?0:t.length)?$t(t,1):[]},wt=xt,jt=s,Rt=c;var Ct=function flatRest$1(t){return Rt(jt(t,void 0,wt),t+"")},St=vt,kt=Ct((function(t,e){return null==t?{}:St(t,e)}));const mapObject=(t,e)=>{const n={};return Object.keys(t).forEach((r=>{n[r]=e(t[r],r)})),n},At=["top","bottom","left","right"].reduce(((t,e)=>[...t,e,`${e}-start`,`${e}-end`,`${e}-center`]),["auto"]),coordsToCss=({x:t,y:e})=>({left:`${t}px`,top:`${e}px`}),parsePlacement=t=>{const[e,n]=t.split("-");return{position:e,align:n||"center"}},calculateContentAlignment=(t,e,n,r)=>"start"===t?e:"end"===t?e+n-r:e+(n-r)/2,calculateContentCoords=(t,e,n)=>{const{position:r,align:a}=parsePlacement(t),o=calculateContentAlignment(a,e.left,e.width,n.width),i=calculateContentAlignment(a,e.top,e.height,n.height);switch(r){case"top":return{x:o,y:e.top-n.height};case"left":return{y:i,x:e.left-n.width};case"right":return{y:i,x:e.right};default:return{x:o,y:e.bottom}}},calculateOffsetCoords=(t,e)=>{const{position:n}=parsePlacement(t),{main:r,cross:a}=(t=>Array.isArray(t)?{main:t[0],cross:t[1]}:{main:t,cross:0})(e);switch(n){case"left":return{y:a,x:-r};case"right":return{y:a,x:r};case"top":return{y:-r,x:a};default:return{y:r,x:a}}},calculateContentOverflow=(t,e,n)=>{const r=n.right,a=n.bottom,o=n.left,i=n.top;return{top:Math.max(i-t.y,0),bottom:Math.max(t.y+e.height-a,0),left:Math.max(o-t.x,0),right:Math.max(t.x+e.width-r,0)}},clamp=(t,e,n)=>Math.max(Math.min(e,n),t),usePopover=(t,e,n)=>{const r=(t=>{if(y()){const e=h(null);return v((()=>{e.value=t()})),e}return h(t())})((()=>document)),a=g((()=>{if(!r.value)return;const{root:t}=d(n);return t?r.value.querySelector(t):r.value.body})),{domRect:o}=useDomRect(t),{domRect:i}=useDomRect(e),u={width:"max-content",position:"absolute"},updateContentCSS=()=>{if(!a.value||!o.value||!i.value)return;let t={x:0,y:0};const{placement:r,keepAnchorWidth:l,offset:s,autoPlacement:c,stickToEdges:f}=d(n);let h=calculateContentCoords(r,o.value,i.value);if(s&&(t=calculateOffsetCoords(r,s),h=mapObject(h,((e,n)=>e+t[n]))),l){const{width:t}=o.value;Object.assign(u,{width:`${t}px`,maxWidth:`${t}px`})}const v=a.value.getBoundingClientRect();if(c){const e=((t,e,n,r)=>{const{position:a,align:o}=parsePlacement(t),i=calculateContentOverflow(e,n,r),u={top:["bottom",o].join("-"),bottom:["top",o].join("-"),right:["left",o].join("-"),left:["right",o].join("-")};return i[a]?u[a]:t})(r,h,i.value,v);e!==r&&(h=calculateContentCoords(e,o.value,i.value),s&&(t=calculateOffsetCoords(e,s),h=mapObject(h,((e,n)=>e+t[n]))))}f&&(h=((t,e,n,r,a)=>{const{top:o,bottom:i,left:u,right:l}=calculateContentOverflow(t,n,a),s=t.x-l+u,c=t.y-i+o,{x:f,y:h}=e;return{x:clamp(r.left+f-n.width,s,r.right+f),y:clamp(r.top+h-n.height,c,r.bottom+h)}})(h,t,i.value,o.value,v)),e.value&&Object.assign(e.value.style,{...u,...coordsToCss(h)})};return p(o,updateContentCSS),p(i,updateContentCSS),p(n,updateContentCSS,{deep:!0}),{anchorDomRect:o,contentDomRect:i}};export{Q as _,J as a,G as b,b as c,Ct as d,kt as e,xt as f,At as p,k as t,usePopover as u};
//# sourceMappingURL=usePopover.mjs.map
