import{toRefs as e,ref as t,watch as l,computed as u,defineComponent as a,shallowRef as o,onMounted as r,nextTick as s,openBlock as i,createElementBlock as n,withKeys as m,withModifiers as c,Fragment as v,renderList as p,normalizeClass as d,renderSlot as f,normalizeProps as h,guardReactiveProps as g,createTextVNode as I,toDisplayString as x,resolveComponent as y,normalizeStyle as b,createBlock as k}from"vue";import{w as C}from"./withConfigTransport.mjs";import{d as P}from"./debounce.mjs";import"./global-config.mjs";import"./usePopover.mjs";import"./global-utils.mjs";import{u as H,a as F}from"./useFocus.mjs";import"colortranslator";import{u as S}from"./useSyncProp.mjs";import{u as N}from"./useArrayRefs.mjs";import{u as w}from"./useCSSVariables.mjs";import{u as M,a as j}from"./useForm.mjs";import{a as A,u as T,b as V}from"./useStateful.mjs";const safeModelValue=e=>e.value?e.value:new Date((new Date).setHours(0,0,0,0)),createNumbersArray=e=>Array.from(Array(e).keys()),from24to12=e=>(0===e?12:e)-12*Number(e>12),createHoursColumn=(e,t,l)=>{const a=u((()=>e.ampm?12:24)),o=u((()=>{let t=createNumbersArray(a.value);return e.hoursFilter&&(t=t.filter((t=>e.hoursFilter(e.ampm?t+12*Number(l.value):t)))),t.map((t=>e.ampm?from24to12(t):t))})),r=u({get:()=>{if(!t.value)return-1;if(e.ampm){const e=from24to12(t.value.getHours()-12*Number(l.value));return o.value.findIndex((t=>t===e))}const u=t.value.getHours();return o.value.findIndex((e=>e===u))},set:u=>{if(e.readonly)return;const a=e.ampm?((e,t=!1)=>(12===e?0:e)+12*Number(t))(o.value[u],l.value):o.value[u];t.value=new Date(safeModelValue(t).setHours(a))}});return u((()=>({items:o.value,activeItem:r})))},useTimePicker=(a,o)=>{const{view:r}=e(a),s=t(!1);l(o,(()=>{s.value=safeModelValue(o).getHours()>=12}),{immediate:!0});const i=createHoursColumn(a,o,s),n=((e,t)=>{const l=u((()=>{const t=createNumbersArray(60);return e.minutesFilter?t.filter(e.minutesFilter):t})),a=u({get:()=>{if(!t.value)return-1;const e=t.value.getMinutes();return l.value.findIndex((t=>t===e))},set:u=>{if(e.readonly)return;const a=l.value[u];t.value=new Date(safeModelValue(t).setMinutes(a))}});return u((()=>({items:l.value,activeItem:a})))})(a,o),m=((e,t)=>{const l=u((()=>{const t=createNumbersArray(60);return e.secondsFilter?t.filter(e.secondsFilter):t})),a=u({get:()=>{if(!t.value)return-1;const e=t.value.getSeconds();return l.value.findIndex((t=>t===e))},set:u=>{if(e.readonly)return;const a=l.value[u];t.value=new Date(safeModelValue(t).setSeconds(a))}});return u((()=>({items:l.value,activeItem:a})))})(a,o),c=((e,t,l)=>u((()=>({items:["AM","PM"],activeItem:u({get:()=>t.value?Number(l.value):-1,set:u=>{l.value=Boolean(u);const a=safeModelValue(t).getHours();let o=l.value?a+12:a;l.value&&a<=12&&(o=a+12),!l.value&&a>=12&&(o=a-12);const r=!e.hoursFilter||e.hoursFilter(o);e.periodUpdatesModelValue&&r&&(t.value=new Date(safeModelValue(t).setHours(o)))}})}))))(a,o,s);return{columns:u((()=>{const e=[];return"hours"===r.value?e.push(i.value):"minutes"===r.value?e.push(i.value,n.value):"seconds"===r.value&&e.push(i.value,n.value,m.value),a.ampm&&!a.hidePeriodSwitch&&e.push(c.value),e})),isPM:s}};var $=a({name:"VaTimePickerColumn",props:{items:{type:Array,default:()=>[]},activeItemIndex:{type:Number,default:0},cellHeight:{type:Number,default:30}},emits:["item-selected","update:activeItemIndex",...H],setup(e,{emit:t}){const u=o(),{focus:a,blur:i}=F(u,t),[n]=S("activeItemIndex",e,t);l(n,(e=>{scrollTo(e)})),r((()=>scrollTo(n.value,!1)));const scrollTo=(t,l=!0)=>{s((()=>{u.value.scrollTo({behavior:l?"smooth":"auto",top:t*e.cellHeight})}))},m=P((()=>{u.value&&-1!==n.value&&(n.value=(()=>{const t=u.value.scrollTop,l=Math.max((t-t%e.cellHeight)/e.cellHeight,t/e.cellHeight);return n.value*e.cellHeight<t?Math.ceil(l):n.value*e.cellHeight>t?Math.floor(l):Math.round(l)})())}),200);return{rootElement:u,makeActiveNext:t=>{n.value=(n.value+(t||1))%e.items.length,s((()=>scrollTo(n.value)))},makeActivePrev:t=>{n.value=(n.value-(t||1)+e.items.length)%e.items.length,s((()=>scrollTo(n.value)))},makeActiveByIndex:e=>{n.value=e,s((()=>scrollTo(n.value)))},onScroll:m,onCellClick:e=>{n.value=e},formatCell:e=>Number.isInteger(e)?e<10?`0${e}`:`${e}`:e,focus:a,blur:i}}});const D=["onClick"];$.render=function render$1(e,t,l,u,a,o){return i(),n("div",{ref:"rootElement",tabindex:"0",class:"va-time-picker-column",onKeydown:[t[0]||(t[0]=m(c((t=>e.makeActiveNext()),["stop","prevent"]),["down"])),t[1]||(t[1]=m(c((t=>e.makeActiveNext(5)),["stop","prevent"]),["space"])),t[2]||(t[2]=m(c((t=>e.makeActivePrev()),["stop","prevent"]),["up"]))],onScrollPassive:t[3]||(t[3]=(...t)=>e.onScroll&&e.onScroll(...t)),onTouchmovePassive:t[4]||(t[4]=(...t)=>e.onScroll&&e.onScroll(...t))},[(i(!0),n(v,null,p(e.items,((t,l)=>(i(),n("div",{key:t,class:d(["va-time-picker-cell",{"va-time-picker-cell--active":l===e.$props.activeItemIndex}]),onClick:t=>e.onCellClick(l)},[f(e.$slots,"cell",h(g({item:t,index:l,activeItemIndex:e.activeItemIndex,items:e.items,formattedItem:e.formatCell(t)})),(()=>[I(x(e.formatCell(t)),1)]))],10,D)))),128))],544)},$.__file="src/components/va-time-picker/components/VaTimePickerColumn/VaTimePickerColumn.vue";var B=a({name:"VaTimePicker",components:{VaTimePickerColumn:C($)},props:{...A,...M,modelValue:{type:Date,required:!1},ampm:{type:Boolean,default:!1},hidePeriodSwitch:{type:Boolean,default:!1},periodUpdatesModelValue:{type:Boolean,default:!0},view:{type:String,default:"minutes"},hoursFilter:{type:Function},minutesFilter:{type:Function},secondsFilter:{type:Function},framed:{type:Boolean,default:!1},cellHeight:{type:Number,default:30},visibleCellsCount:{type:Number,default:7}},emits:T,setup(e,{emit:l}){const{valueComputed:a}=V(e,l),{columns:o,isPM:r}=useTimePicker(e,a),{setItemRef:s,itemRefs:i}=N(),n=t(),focus=(e=0)=>{var t;null===(t=i.value[e])||void 0===t||t.focus()},{computedClasses:m}=j("va-time-picker",e),c=u((()=>({...m,"va-time-picker--framed":e.framed}))),v=w("va-time-picker",(()=>{const t=(e.visibleCellsCount-1)/2*e.cellHeight;return{height:e.cellHeight*e.visibleCellsCount+"px","cell-height":`${e.cellHeight}px`,"column-gap-height":`${t}px`}}));return{columns:o,computedStyles:v,computedClasses:c,isPM:r,pickers:i,setItemRef:s,focusNext:()=>{const e=((null==n?void 0:n.value)||0)+1;n.value=e%o.value.length,focus(n.value)},focusPrev:()=>{const e=((null==n?void 0:n.value)||0)-1+o.value.length;n.value=e%o.value.length,focus(n.value)},activeColumnIndex:n,focus:focus,blur:e=>{var t;e?null===(t=i.value[e])||void 0===t||t.blur():i.value.forEach((e=>null==e?void 0:e.blur()))}}}});B.render=function render(e,t,l,u,a,o){const r=y("VaTimePickerColumn");return i(),n("div",{class:d(["va-time-picker",e.computedClasses]),style:b(e.computedStyles)},[(i(!0),n(v,null,p(e.columns,((l,u)=>(i(),k(r,{key:u,ref_for:!0,ref:e.setItemRef,items:l.items,tabindex:e.disabled?-1:0,"cell-height":e.$props.cellHeight,activeItemIndex:l.activeItem.value,"onUpdate:activeItemIndex":e=>l.activeItem.value=e,onKeydown:[t[0]||(t[0]=m(c((t=>e.focusNext()),["stop","prevent"]),["right"])),t[1]||(t[1]=m(c((t=>e.focusNext()),["exact","stop","prevent"]),["tab"])),t[2]||(t[2]=m(c((t=>e.focusPrev()),["stop","prevent"]),["left"])),t[3]||(t[3]=m(c((t=>e.focusPrev()),["shift","stop","prevent"]),["tab"]))],onFocus:t=>e.activeColumnIndex=u},null,8,["items","tabindex","cell-height","activeItemIndex","onUpdate:activeItemIndex","onFocus"])))),128))],6)},B.__file="src/components/va-time-picker/VaTimePicker.vue";export{B as s};
//# sourceMappingURL=VaTimePicker.mjs.map
