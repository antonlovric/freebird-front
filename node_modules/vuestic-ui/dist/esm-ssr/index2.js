import{w as t}from"./withConfigTransport.js";import{defineComponent as e,shallowRef as o,computed as i,ref as n,onMounted as f,nextTick as r,onBeforeUnmount as s,mergeProps as d}from"vue";import{g as a}from"./ssr-utils.js";import{d as l}from"./debounce.js";import{f as u}from"./global-config.js";import{ssrRenderAttrs as c,ssrRenderStyle as m,ssrRenderSlot as p,ssrRenderClass as g}from"@vue/server-renderer";import"./VaConfig.js";import"./toNumber.js";import"./isSymbol.js";import"./global-properties.js";var v=function noop(){},h=l,x=u;var w=function throttle(t,e,o){var i=!0,n=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return x(o)&&(i="leading"in o?!!o.leading:i,n="trailing"in o?!!o.trailing:n),h(t,e,{leading:i,maxWait:e,trailing:n})};function getWindowHeight(){return document.documentElement.clientHeight||window.innerHeight||document.body.clientHeight}function computeAffixedState({coordinates:t,offsetTop:e,offsetBottom:o,target:i}){let n=!1,f=!1;const r=getWindowHeight();if(null!=e&&r)if(i===window)n=t.top<=e;else{const{top:o}=i.getBoundingClientRect();n=t.top-o<=e}if(null!=o&&r)if(i===window)f=t.bottom>=r-o;else{const{bottom:e}=i.getBoundingClientRect();f=e-t.bottom<=o}return{isTopAffixed:n,isBottomAffixed:f}}function handleThrottledEvent(t,e){const{target:o,element:i,offsetTop:n,offsetBottom:f,setState:r,getState:s,initialPosition:d}=e;if(!i)return;const a=!t,l=i.getBoundingClientRect(),u={offsetBottom:f,offsetTop:n,target:o},c=computeAffixedState(a&&d?{coordinates:d,...u}:{coordinates:l,...u}),m=s();!function checkAffixedStateChange(t,e){return t.isTopAffixed!==e.isTopAffixed||t.isBottomAffixed!==e.isBottomAffixed}(m,c)?m.width!==l.width&&r({...m,width:l.width}):r({...c,width:l.width})}function useCaptureDefault(t){return"scroll"===t}var A=e({name:"VaAffix",emits:["change"],props:{offsetTop:{type:Number,default:void 0},offsetBottom:{type:Number,default:void 0},target:{type:[Object,Function],default:a}},setup(t,{emit:e}){const d=o(),getTargetElement=()=>"function"==typeof t.target?t.target():t.target,a=i((()=>l.value.isTopAffixed||l.value.isBottomAffixed)),l=n({isTopAffixed:!1,isBottomAffixed:!1}),getState=()=>l.value,setState=t=>{l.value=t,e("change",a)},calculateTop=()=>{const e=getTargetElement();if(!e)return 0;if(void 0!==t.offsetTop){if(!(e instanceof Window)){const{top:o}=e.getBoundingClientRect();return o+t.offsetTop}return t.offsetTop}},calculateBottom=()=>{const e=getTargetElement();if(!e)return 0;if(void 0!==t.offsetBottom){if(!(e instanceof Window)){const{bottom:o}=e.getBoundingClientRect(),{borderTopWidth:i,borderBottomWidth:n}=getComputedStyle(e),{offsetHeight:f,clientHeight:r}=e,s=f-r-parseInt(i)-parseInt(n);return getWindowHeight()-(o-t.offsetBottom)+s}return t.offsetBottom}},convertToPixels=t=>{const e=t();return void 0===e?void 0:`${e}px`},u=i((()=>[{"va-affix--affixed":a}])),c=i((()=>({top:l.value.isTopAffixed?convertToPixels(calculateTop):void 0,bottom:l.value.isBottomAffixed?convertToPixels(calculateBottom):void 0,width:`${l.value.width}px`}))),m=n(),throttledEventHandler=(e,o)=>{const i={...t,initialPosition:m.value,element:d.value,target:getTargetElement(),setState:setState,getState:getState};if(e&&"resize"!==e){if(o&&o.target){const t=getTargetElement();t===o.target||t instanceof Window?handleThrottledEvent(e,i):setState({isBottomAffixed:!1,isTopAffixed:!1})}}else handleThrottledEvent(e,i)};let p=v;return f((()=>{var t;m.value=null===(t=d.value)||void 0===t?void 0:t.getBoundingClientRect();p=function useEventsHandlerWithThrottle(t,{handler:e,useCapture:o=useCaptureDefault,wait:i=50}){const n=t.map((t=>{const n=w((o=>e(t,o)),i);return window.addEventListener(t,n,o(t)),()=>window.removeEventListener(t,n,o(t))}));return()=>n.forEach((t=>t()))}(["scroll","resize"],{handler:throttledEventHandler}),r((()=>{throttledEventHandler(null)}))})),s(p),{computedClass:u,computedStyle:c,isAffixed:a,element:d}}});A.ssrRender=function ssrRender(t,e,o,i,n,f,r,s){e(`<div${c(d({ref:"element",class:"va-affix"},i))}><div style="${m({visibility:t.isAffixed?"hidden":"inherit"})}">`),p(t.$slots,"default",{},null,e,o),e("</div>"),t.isAffixed?(e(`<div class="${g(t.computedClass)}" style="${m(t.computedStyle)}">`),p(t.$slots,"default",{},null,e,o),e("</div>")):e("\x3c!----\x3e"),e("</div>")},A.__file="src/components/va-affix/VaAffix.vue";const B=t(A);export{B as VaAffix};
//# sourceMappingURL=index2.js.map
