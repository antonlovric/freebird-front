import{w as e}from"./withConfigTransport.js";import{onMounted as l,onBeforeUnmount as r,defineComponent as o,shallowRef as i,ref as s,computed as t,watch as n,resolveComponent as a,createVNode as v,resolveDynamicComponent as u,mergeProps as c,withCtx as d,renderSlot as p,createCommentVNode as f}from"vue";import{d as m}from"./debounce.js";import{s as g}from"./utils.js";import"./global-config.js";import"./usePopover.js";import"./global-utils.js";import{u as b}from"./useColors.js";import{VaProgressCircle as _}from"./index43.js";import{ssrRenderVNode as h,ssrRenderSlot as j,ssrRenderClass as y,ssrRenderComponent as S}from"@vue/server-renderer";import"./VaConfig.js";import"./toNumber.js";import"./isSymbol.js";import"./global-properties.js";import"./ssr-utils.js";import"colortranslator";import"./clamp.js";import"./useSize.js";var $=o({name:"VaInfiniteScroll",components:{VaProgressCircle:_},props:{load:{type:Function,required:!0},offset:{type:Number,default:500},reverse:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},scrollTarget:{type:[String,Object],default:void 0},debounce:{type:Number,default:100},tag:{type:String,default:"div"}},emits:["onload","onerror"],setup(e,{emit:o}){const a=i(),v=i(),u=s(!1),c=s(!1),d=s(!1),p=s(),f=s(0),_=s(0),h=t((()=>{var l;let r;return r="string"==typeof e.scrollTarget?document.querySelector(e.scrollTarget):e.scrollTarget||(null===(l=a.value)||void 0===l?void 0:l.parentElement),r||document.body})),{addScrollListener:j,removeScrollListener:y}=((e,o,i)=>{const addScrollListener=()=>{var e;null===(e=o.value)||void 0===e||e.addEventListener("scroll",i.value,{passive:!0})},removeScrollListener=()=>{var e;null===(e=o.value)||void 0===e||e.removeEventListener("scroll",i.value)};return l((()=>{o.value&&(o.value.style.overflowY="scroll",e.reverse&&(o.value.scrollTop=o.value.scrollHeight),addScrollListener())})),r(removeScrollListener),{addScrollListener:addScrollListener,removeScrollListener:removeScrollListener}})(e,h,p),{getColor:S}=b(),$=t((()=>c.value?S("danger"):S("primary"))),C=t((()=>{var e;return(null===(e=v.value)||void 0===e?void 0:e.offsetHeight)||0})),T=t((()=>e.offset+C.value)),stop=()=>{e.disabled||(u.value=!1,y())},resume=()=>{e.disabled||j()},onLoad=()=>{const{scrollTop:l,scrollHeight:r,clientHeight:o}=h.value;f.value=r-l;const i=l-_.value;if(_.value=l,e.disabled||c.value||u.value)return;if(d.value)return void(d.value=!1);if(e.reverse&&i>0||!e.reverse&&i<0)return;(e.reverse?l:r-l-o)>T.value||(u.value=!0,e.load().then(finishLoading).catch(onError))},forceSetScrollTopToTarget=e=>{d.value=!0,h.value.scrollTop=e},updateTargetElementScrollTop=()=>{const{scrollTop:l,scrollHeight:r,clientHeight:o}=h.value;if(e.reverse){const e=r-l<f.value,o=l>=C.value;if(e&&o)return;r-f.value>C.value?forceSetScrollTopToTarget(r-f.value):forceSetScrollTopToTarget(C.value)}if(!e.reverse){!(r-l-o>=C.value)&&forceSetScrollTopToTarget(r-o-C.value)}},finishLoading=()=>{updateTargetElementScrollTop(),u.value=!1,o("onload")},stopErrorDisplay=()=>{updateTargetElementScrollTop(),d.value=!1,c.value=!1,u.value=!1,o("onerror")},onError=()=>{stop(),c.value=!0,g(1200).then(stopErrorDisplay).then(resume)};return n((()=>e.debounce),(e=>{p.value=m(onLoad,e)}),{immediate:!0}),n((()=>e.disabled),(e=>{e?stop():resume()})),{element:a,spinnerSlotContainer:v,spinnerColor:$,fetching:u}}});$.ssrRender=function ssrRender(e,l,r,o,i,s,t,n){const m=a("va-progress-circle");h(l,v(u(e.$props.tag),c({ref:"element",role:"feed",class:["va-infinite-scroll",{"va-infinite-scroll--reversed":e.$props.reverse}],"aria-busy":e.fetching},o),{default:d(((l,r,o,i)=>{if(!r)return[p(e.$slots,"default"),v("div",{ref:"spinnerSlotContainer",class:["va-infinite-scroll__spinner",{"va-infinite-scroll__spinner--invisible":!e.fetching}]},[e.$props.disabled?f("v-if",!0):p(e.$slots,"loading",{key:0},(()=>[v("div",{class:"va-infinite-scroll__spinner__default"},[v(m,{size:"small",thickness:.15,color:e.spinnerColor,indeterminate:""},null,8,["thickness","color"])])]))],2)];j(e.$slots,"default",{},null,r,o,i),r(`<div class="${y([{"va-infinite-scroll__spinner--invisible":!e.fetching},"va-infinite-scroll__spinner"])}"${i}>`),e.$props.disabled?r("\x3c!----\x3e"):j(e.$slots,"loading",{},(()=>{r(`<div class="va-infinite-scroll__spinner__default"${i}>`),r(S(m,{size:"small",thickness:.15,color:e.spinnerColor,indeterminate:""},null,o,i)),r("</div>")}),r,o,i),r("</div>")})),_:3}),r)},$.__file="src/components/va-infinite-scroll/VaInfiniteScroll.vue";const C=e($);export{C as VaInfiniteScroll};
//# sourceMappingURL=index33.js.map
