import{defineComponent as e,shallowRef as t,ref as o,computed as s,onMounted as n,resolveComponent as a,mergeProps as l,getCurrentInstance as r,createVNode as i,render as c}from"vue";import{a as u}from"./ssr-utils.js";import{w as p}from"./withConfigTransport.js";import"./global-config.js";import"./usePopover.js";import"./global-utils.js";import{u as d}from"./useColors.js";import{u as f}from"./useTextColor.js";import{s as v}from"./VaIcon.js";import{ssrRenderAttrs as m,ssrInterpolate as g,ssrRenderStyle as y,ssrRenderComponent as C}from"@vue/server-renderer";const T=e({name:"VaToastRenderer",props:{render:{type:Function,required:!0}},setup:e=>()=>e.render()});var h=e({name:"VaToast",components:{VaIcon:v,VaToastRenderer:T},emits:["on-click","on-close"],props:{title:{type:String,default:""},offsetY:{type:Number,default:16},offsetX:{type:Number,default:16},message:{type:[String,Function],default:""},dangerouslyUseHtmlString:{type:Boolean,default:!1},icon:{type:String,default:"close"},customClass:{type:String,default:""},duration:{type:Number,default:5e3},color:{type:String,default:""},closeable:{type:Boolean,default:!0},onClose:{type:Function},onClick:{type:Function},multiLine:{type:Boolean,default:!1},position:{type:String,default:"top-right",validator:e=>["top-right","top-left","bottom-right","bottom-left"].includes(e)},render:{type:Function}},setup(e,{emit:a}){const l=t(),{getColor:r}=d(),{textColorComputed:i}=f(),c=o(!1),u=s((()=>e.position.includes("right")?"right":"left")),p=s((()=>e.position.includes("top")?"top":"bottom")),v=s((()=>[e.customClass,e.multiLine?"va-toast--multiline":""])),m=s((()=>({[p.value]:`${e.offsetY}px`,[u.value]:`${e.offsetX}px`,backgroundColor:r(e.color),color:i.value}))),g=s((()=>"function"==typeof e.message?e.message():e.message)),destroyElement=()=>{var e,t;null===(e=l.value)||void 0===e||e.removeEventListener("transitionend",destroyElement),null===(t=l.value)||void 0===t||t.remove()},onToastClose=()=>{var t;c.value=!1,null===(t=l.value)||void 0===t||t.addEventListener("transitionend",destroyElement),"function"==typeof e.onClose?e.onClose():a("on-close")},y=(()=>{let e;return{start:(...t)=>(e=window.setTimeout(...t),e),clear:()=>e&&window.clearTimeout(e)}})(),C=y.clear,startTimer=()=>{e.duration>0&&y.start((()=>c.value&&onToastClose()),e.duration)};return n((()=>{c.value=!0,startTimer()})),{visible:c,toastClasses:v,toastStyles:m,computedMessage:g,onToastClick:()=>{"function"==typeof e.onClick?e.onClick():a("on-click")},onToastClose:onToastClose,startTimer:startTimer,clearTimer:C}}});h.ssrRender=function ssrRender(e,t,o,s,n,r,i,c){const u=a("VaToastRenderer"),p=a("va-icon");t(`<div${m(l({style:[e.visible?null:{display:"none"},e.toastStyles],ref:"rootElement",role:e.$props.closeable?"alertdialog":"alert",class:["va-toast",e.toastClasses]},s))}><div class="va-toast__group">`),e.$props.title?t(`<h2 class="va-toast__title">${g(e.$props.title)}</h2>`):t("\x3c!----\x3e"),t(`<div class="va-toast__content" style="${y(e.$props.message?null:{display:"none"})}">`),e.$props.dangerouslyUseHtmlString?t(`<div>${e.computedMessage}</div>`):t(`<p>${g(e.computedMessage)}</p>`),t("</div>"),e.$props.render?(t('<div class="va-toast__content">'),t(C(u,{render:e.$props.render},null,o)),t("</div>")):t("\x3c!----\x3e"),e.$props.closeable?t(C(p,{class:"va-toast__close-icon",role:"button","aria-label":"close toast","aria-hidden":"false",tabindex:"0",size:"small",name:e.$props.icon},null,o)):t("\x3c!----\x3e"),t("</div></div>")},h.__file="src/components/va-toast/VaToast.vue";const useToast=()=>{var e;const t=null===(e=r())||void 0===e?void 0:e.appContext,o=[];return{init:e=>{const s=createToastInstance(e,t);return s&&o.push(s),s},close:e=>closeById(e),closeAll:(e=!1)=>closeAllNotifications(e?void 0:t),closeAllCreatedInThisHook:()=>{o.forEach((e=>closeById(e)))}}},x=p(h);let b=1;u().vaToastInstances=[];const getNodeProps=e=>{var t;return(null===(t=e.component)||void 0===t?void 0:t.props)||{}},closeNotification=(e,t)=>{var o;if(!e)return;if(!u().vaToastInstances.length)return void(b=1);const s=u().vaToastInstances.findIndex((t=>t===e));if(s<0)return;const n=getNodeProps(e),{offsetX:a,offsetY:l,position:r}=n,i=null===(o=e.el)||void 0===o?void 0:o.offsetHeight;t(),u().vaToastInstances=u().vaToastInstances.reduce(((t,o,n)=>{if(o===e)return t;if(o.component){const{offsetX:e,offsetY:t,position:c}=getNodeProps(o);if(n>s&&a===e&&l===t&&r===c&&o.el&&i){const[e,t]=o.el.style.transform.match(/[\d-]+(?=px)/g),s=((e,t,o)=>{const s=o.includes("bottom")?-1:1;return parseInt(e,10)-(t+5)*s})(t,i,c);o.el.style.transform=`translate(0, ${s}px)`}}return[...t,o]}),[]),u().vaToastInstances.length||(b=1)},mount=(e,{props:t,children:o,element:s,appContext:n}={})=>{let a,l=s;return a=i(e,{...t,onClose:()=>{closeNotification(a,(()=>((e,t)=>{e&&(c(null,e),e.remove()),e=null})(l))),(null==t?void 0:t.onClose)&&t.onClose()}},o),n&&(a.appContext=n),l?c(a,l):"undefined"!=typeof document&&c(a,l=document.createElement("div")),{vNode:a,el:l}},closeAllNotifications=e=>{u().vaToastInstances.length?u().vaToastInstances.forEach((t=>{e&&t.appContext!==e||getNodeProps(t).onClose()})):b=1},closeById=e=>{const t=u().vaToastInstances.find((t=>{var o;return(null===(o=t.el)||void 0===o?void 0:o.id)===e}));if(t){getNodeProps(t).onClose()}},createToastInstance=(e,t)=>{const{vNode:o,el:s}=mount(x,{appContext:t,props:(n=e,"string"==typeof n?{message:n}:n)});var n;const a=getNodeProps(o);if(s&&o.el&&a){document.body.appendChild(s.childNodes[0]);const{offsetX:e,offsetY:t,position:n}=a;o.el.style.display="flex",o.el.id="notification_"+b;let l=0;return u().vaToastInstances.filter((o=>{const{offsetX:s,offsetY:a,position:l}=getNodeProps(o);return s===e&&a===t&&n===l})).forEach((e=>{l+=((e,t)=>{if(e.el){const o=t.includes("bottom")?-1:1;return(e.el.offsetHeight+5)*o}return 0})(e,n)})),o.el.style.transform=`translate(0, ${l}px)`,b+=1,u().vaToastInstances.push(o),o.el.id}return null};export{x as V,closeById as a,closeAllNotifications as b,createToastInstance as c,useToast as u};
//# sourceMappingURL=toast.js.map
