{"version":3,"file":"useStateful.js","sources":["../../src/composables/useStateful.ts"],"sourcesContent":["import { ref, computed, PropType, Ref, watch } from 'vue'\n\nexport type StatefulProps<T> = {\n  stateful: boolean\n  modelValue: T\n}\n\n/**\n * You could add these props to any component by destructuring them inside props option.\n * @example\n * props: { ...useStatefulProps, componentsOwnProp, etc. }\n * It's better to add props at the beginning, to make sure that Component own props will be used instead in case of collision\n */\nexport const useStatefulProps = {\n  stateful: { type: Boolean as PropType<boolean>, default: false },\n  modelValue: { type: undefined as any },\n}\n\nexport const useStatefulEmits = ['update:modelValue']\n\n/**\n * Returns `valueComputed` that is proxy for `modelValue`\n * if `stateful` prop is `false`\n * Record<any, any> & Record<'modelValue', T>\n */\nexport function useStateful<T, D extends T = T> (\n  props: StatefulProps<T>,\n  emit: (event: 'update:modelValue', newValue: T) => void,\n  defaultValue?: D,\n) {\n  const valueState = ref(defaultValue === undefined ? props.modelValue : defaultValue) as Ref<T>\n  let unwatchModelValue: Function\n\n  const watchModelValue = () => {\n    unwatchModelValue = watch(() => props.modelValue, (modelValue) => {\n      valueState.value = modelValue\n    })\n  }\n\n  watch(() => props.stateful, (stateful: boolean) => {\n    stateful ? watchModelValue() : unwatchModelValue?.()\n  }, { immediate: true })\n\n  const valueComputed = computed<T>({\n    get () {\n      if (props.stateful) {\n        return valueState.value\n      }\n      return props.modelValue\n    },\n    set (value: T) {\n      if (props.stateful) {\n        valueState.value = value\n      }\n      emit('update:modelValue', value)\n    },\n  })\n\n  return { valueComputed }\n}\n"],"names":["useStatefulProps","stateful","type","Boolean","default","modelValue","undefined","useStatefulEmits","useStateful","props","emit","defaultValue","valueState","ref","unwatchModelValue","watch","value","immediate","valueComputed","computed","get","set"],"mappings":"mDAaa,MAAAA,EAAmB,CAC9BC,SAAU,CAAEC,KAAMC,QAA8BC,SAAS,GACzDC,WAAY,CAAEH,UAAMI,IAGTC,EAAmB,CAAC,8BAOjBC,YACdC,EACAC,EACAC,GAEA,MAAMC,EAAaC,OAAqBP,IAAjBK,EAA6BF,EAAMJ,WAAaM,GACvE,IAAIG,EAQJC,GAAM,IAAMN,EAAMR,WAAWA,IAC3BA,EANAa,EAAoBC,GAAM,IAAMN,EAAMJ,aAAaA,IACjDO,EAAWI,MAAQX,KAKUS,MAAAA,GAAAA,MAC9B,CAAEG,WAAW,IAiBhB,MAAO,CAAEC,cAfaC,EAAY,CAChCC,IAAG,IACGX,EAAMR,SACDW,EAAWI,MAEbP,EAAMJ,WAEfgB,IAAKL,GACCP,EAAMR,WACRW,EAAWI,MAAQA,GAErBN,EAAK,oBAAqBM"}