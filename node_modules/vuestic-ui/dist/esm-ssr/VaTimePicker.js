import{toRefs as e,ref as t,watch as l,computed as u,defineComponent as a,shallowRef as r,onMounted as s,nextTick as i,mergeProps as o,resolveComponent as n}from"vue";import{w as m}from"./withConfigTransport.js";import{d as c}from"./debounce.js";import"./global-config.js";import"./usePopover.js";import"./global-utils.js";import{u as v,a as d}from"./useFocus.js";import"colortranslator";import{u as p}from"./useSyncProp.js";import{ssrRenderAttrs as f,ssrRenderList as h,ssrRenderClass as g,ssrRenderSlot as I,ssrInterpolate as x,ssrRenderComponent as y}from"@vue/server-renderer";import{u as b}from"./useArrayRefs.js";import{u as k}from"./useCSSVariables.js";import{u as C,a as H}from"./useForm.js";import{a as P,u as F,b as M}from"./useStateful.js";const safeModelValue=e=>e.value?e.value:new Date((new Date).setHours(0,0,0,0)),createNumbersArray=e=>Array.from(Array(e).keys()),from24to12=e=>(0===e?12:e)-12*Number(e>12),createHoursColumn=(e,t,l)=>{const a=u((()=>e.ampm?12:24)),r=u((()=>{let t=createNumbersArray(a.value);return e.hoursFilter&&(t=t.filter((t=>e.hoursFilter(e.ampm?t+12*Number(l.value):t)))),t.map((t=>e.ampm?from24to12(t):t))})),s=u({get:()=>{if(!t.value)return-1;if(e.ampm){const e=from24to12(t.value.getHours()-12*Number(l.value));return r.value.findIndex((t=>t===e))}const u=t.value.getHours();return r.value.findIndex((e=>e===u))},set:u=>{if(e.readonly)return;const a=e.ampm?((e,t=!1)=>(12===e?0:e)+12*Number(t))(r.value[u],l.value):r.value[u];t.value=new Date(safeModelValue(t).setHours(a))}});return u((()=>({items:r.value,activeItem:s})))},useTimePicker=(a,r)=>{const{view:s}=e(a),i=t(!1);l(r,(()=>{i.value=safeModelValue(r).getHours()>=12}),{immediate:!0});const o=createHoursColumn(a,r,i),n=((e,t)=>{const l=u((()=>{const t=createNumbersArray(60);return e.minutesFilter?t.filter(e.minutesFilter):t})),a=u({get:()=>{if(!t.value)return-1;const e=t.value.getMinutes();return l.value.findIndex((t=>t===e))},set:u=>{if(e.readonly)return;const a=l.value[u];t.value=new Date(safeModelValue(t).setMinutes(a))}});return u((()=>({items:l.value,activeItem:a})))})(a,r),m=((e,t)=>{const l=u((()=>{const t=createNumbersArray(60);return e.secondsFilter?t.filter(e.secondsFilter):t})),a=u({get:()=>{if(!t.value)return-1;const e=t.value.getSeconds();return l.value.findIndex((t=>t===e))},set:u=>{if(e.readonly)return;const a=l.value[u];t.value=new Date(safeModelValue(t).setSeconds(a))}});return u((()=>({items:l.value,activeItem:a})))})(a,r),c=((e,t,l)=>u((()=>({items:["AM","PM"],activeItem:u({get:()=>t.value?Number(l.value):-1,set:u=>{l.value=Boolean(u);const a=safeModelValue(t).getHours();let r=l.value?a+12:a;l.value&&a<=12&&(r=a+12),!l.value&&a>=12&&(r=a-12);const s=!e.hoursFilter||e.hoursFilter(r);e.periodUpdatesModelValue&&s&&(t.value=new Date(safeModelValue(t).setHours(r)))}})}))))(a,r,i);return{columns:u((()=>{const e=[];return"hours"===s.value?e.push(o.value):"minutes"===s.value?e.push(o.value,n.value):"seconds"===s.value&&e.push(o.value,n.value,m.value),a.ampm&&!a.hidePeriodSwitch&&e.push(c.value),e})),isPM:i}};var w=a({name:"VaTimePickerColumn",props:{items:{type:Array,default:()=>[]},activeItemIndex:{type:Number,default:0},cellHeight:{type:Number,default:30}},emits:["item-selected","update:activeItemIndex",...v],setup(e,{emit:t}){const u=r(),{focus:a,blur:o}=d(u,t),[n]=p("activeItemIndex",e,t);l(n,(e=>{scrollTo(e)})),s((()=>scrollTo(n.value,!1)));const scrollTo=(t,l=!0)=>{i((()=>{u.value.scrollTo({behavior:l?"smooth":"auto",top:t*e.cellHeight})}))},m=c((()=>{u.value&&-1!==n.value&&(n.value=(()=>{const t=u.value.scrollTop,l=Math.max((t-t%e.cellHeight)/e.cellHeight,t/e.cellHeight);return n.value*e.cellHeight<t?Math.ceil(l):n.value*e.cellHeight>t?Math.floor(l):Math.round(l)})())}),200);return{rootElement:u,makeActiveNext:t=>{n.value=(n.value+(t||1))%e.items.length,i((()=>scrollTo(n.value)))},makeActivePrev:t=>{n.value=(n.value-(t||1)+e.items.length)%e.items.length,i((()=>scrollTo(n.value)))},makeActiveByIndex:e=>{n.value=e,i((()=>scrollTo(n.value)))},onScroll:m,onCellClick:e=>{n.value=e},formatCell:e=>Number.isInteger(e)?e<10?`0${e}`:`${e}`:e,focus:a,blur:o}}});w.ssrRender=function ssrRender$1(e,t,l,u,a,r,s,i){t(`<div${f(o({ref:"rootElement",tabindex:"0",class:"va-time-picker-column"},u))}>\x3c!--[--\x3e`),h(e.items,((u,a)=>{t(`<div class="${g([{"va-time-picker-cell--active":a===e.$props.activeItemIndex},"va-time-picker-cell"])}">`),I(e.$slots,"cell",{item:u,index:a,activeItemIndex:e.activeItemIndex,items:e.items,formattedItem:e.formatCell(u)},(()=>{t(`${x(e.formatCell(u))}`)}),t,l),t("</div>")})),t("\x3c!--]--\x3e</div>")},w.__file="src/components/va-time-picker/components/VaTimePickerColumn/VaTimePickerColumn.vue";var N=a({name:"VaTimePicker",components:{VaTimePickerColumn:m(w)},props:{...P,...C,modelValue:{type:Date,required:!1},ampm:{type:Boolean,default:!1},hidePeriodSwitch:{type:Boolean,default:!1},periodUpdatesModelValue:{type:Boolean,default:!0},view:{type:String,default:"minutes"},hoursFilter:{type:Function},minutesFilter:{type:Function},secondsFilter:{type:Function},framed:{type:Boolean,default:!1},cellHeight:{type:Number,default:30},visibleCellsCount:{type:Number,default:7}},emits:F,setup(e,{emit:l}){const{valueComputed:a}=M(e,l),{columns:r,isPM:s}=useTimePicker(e,a),{setItemRef:i,itemRefs:o}=b(),n=t(),focus=(e=0)=>{var t;null===(t=o.value[e])||void 0===t||t.focus()},{computedClasses:m}=H("va-time-picker",e),c=u((()=>({...m,"va-time-picker--framed":e.framed}))),v=k("va-time-picker",(()=>{const t=(e.visibleCellsCount-1)/2*e.cellHeight;return{height:e.cellHeight*e.visibleCellsCount+"px","cell-height":`${e.cellHeight}px`,"column-gap-height":`${t}px`}}));return{columns:r,computedStyles:v,computedClasses:c,isPM:s,pickers:o,setItemRef:i,focusNext:()=>{const e=((null==n?void 0:n.value)||0)+1;n.value=e%r.value.length,focus(n.value)},focusPrev:()=>{const e=((null==n?void 0:n.value)||0)-1+r.value.length;n.value=e%r.value.length,focus(n.value)},activeColumnIndex:n,focus:focus,blur:e=>{var t;e?null===(t=o.value[e])||void 0===t||t.blur():o.value.forEach((e=>null==e?void 0:e.blur()))}}}});N.ssrRender=function ssrRender(e,t,l,u,a,r,s,i){const m=n("VaTimePickerColumn");t(`<div${f(o({class:["va-time-picker",e.computedClasses],style:e.computedStyles},u))}>\x3c!--[--\x3e`),h(e.columns,((u,a)=>{t(y(m,{key:a,ref_for:!0,ref:e.setItemRef,items:u.items,tabindex:e.disabled?-1:0,"cell-height":e.$props.cellHeight,activeItemIndex:u.activeItem.value,"onUpdate:activeItemIndex":e=>u.activeItem.value=e},null,l))})),t("\x3c!--]--\x3e</div>")},N.__file="src/components/va-time-picker/VaTimePicker.vue";export{N as s};
//# sourceMappingURL=VaTimePicker.js.map
