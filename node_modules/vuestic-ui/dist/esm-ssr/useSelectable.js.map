{"version":3,"file":"useSelectable.js","sources":["../../src/composables/useSelectable.ts"],"sourcesContent":["import { PropType, computed, SetupContext, ShallowRef, ExtractPropTypes } from 'vue'\n\nimport { useStateful, useStatefulProps, StatefulProps } from './useStateful'\nimport { useLoadingProps, LoadingProps } from './useLoading'\nimport { useValidation, useValidationProps, ValidationProps, useValidationEmits } from './useValidation'\nimport { useFocus } from './useFocus'\n\nexport type SelectableProps<V = any> = StatefulProps<V> & LoadingProps & ExtractPropTypes<ValidationProps<V>> & {\n  arrayValue: V | null,\n  label: string,\n  leftLabel: boolean,\n  trueValue: boolean,\n  falseValue: boolean,\n  indeterminate: boolean,\n  indeterminateValue: V | null,\n  disabled: boolean,\n  readonly: boolean,\n}\n\nexport type Elements = {\n  input: ShallowRef<HTMLElement | undefined>,\n  label: ShallowRef<HTMLElement | undefined>,\n  container: ShallowRef<HTMLElement | undefined>,\n}\n\nexport const useSelectableProps = {\n  ...useStatefulProps,\n  ...useLoadingProps,\n  ...useValidationProps,\n  arrayValue: { type: null as any as PropType<unknown>, default: null },\n  label: { type: String, default: '' },\n  leftLabel: { type: Boolean, default: false },\n  trueValue: { type: null as any as PropType<unknown>, default: true },\n  falseValue: { type: null as any as PropType<unknown>, default: false },\n  indeterminate: { type: Boolean, default: false },\n  indeterminateValue: { type: null as any as PropType<unknown>, default: null },\n  disabled: { type: Boolean, default: false },\n  readonly: { type: Boolean, default: false },\n}\n\nexport const useSelectableEmits = [...useValidationEmits, 'update:modelValue', 'focus', 'blur']\n\nconst checkDuplicates = (props: SelectableProps) => {\n  // Just validating state values.\n  const values: unknown[] = [props.falseValue, props.trueValue]\n\n  if (props.indeterminate) {\n    values.push(props.indeterminateValue)\n  }\n\n  const hasDuplicates = new Set(values).size !== values.length\n\n  if (hasDuplicates) {\n    throw new Error('falseValue, trueValue, indeterminateValue props should have strictly different values, which is not the case.')\n  }\n}\n\nexport const useSelectable = (\n  props: SelectableProps,\n  emit: SetupContext['emit'],\n  { input, label, container }: Elements,\n) => {\n  checkDuplicates(props)\n\n  /** @public */\n  const reset = () => emit('update:modelValue', false)\n  const focus = () => input.value?.focus()\n\n  const { computedError, computedErrorMessages, validate } = useValidation(props, emit, reset, focus)\n  const { valueComputed } = useStateful(props, emit)\n  const { isFocused } = useFocus()\n\n  const isElementRelated = (element: HTMLElement | undefined) => {\n    return !!element && [label.value, container.value].includes(element)\n  }\n  const onBlur = (event: FocusEvent) => {\n    if ((input.value === event.target) && !isElementRelated(event.relatedTarget as HTMLElement)) {\n      isFocused.value = false\n      computedError.value = false\n      validate()\n      emit('blur', event)\n    }\n  }\n  const onFocus = (event: FocusEvent) => {\n    isFocused.value = true\n    emit('focus', event)\n  }\n\n  const isIndeterminate = computed(() => !!props.indeterminate && valueComputed.value === props.indeterminateValue)\n  const modelIsArray = computed(() => props.arrayValue !== null)\n  const isChecked = computed(() => {\n    if (modelIsArray.value) {\n      return (props.modelValue as unknown[])?.includes(props.arrayValue)\n    }\n\n    return valueComputed.value === props.trueValue\n  })\n  const toggleSelection = () => {\n    if (props.readonly || props.disabled || props.loading) {\n      return\n    }\n\n    // For array access we pretend computedValue does not exist and use modelValue + emit input directly.\n    if (modelIsArray.value) {\n      if (!props.modelValue) {\n        emit('update:modelValue', [props.arrayValue])\n      } else if (!Array.isArray(props.modelValue)) {\n        emit('update:modelValue', props.modelValue === props.arrayValue ? [] : [props.modelValue, props.arrayValue])\n      } else if (props.modelValue.includes(props.arrayValue)) {\n        emit('update:modelValue', props.modelValue.filter((option) => option !== props.arrayValue))\n      } else {\n        emit('update:modelValue', props.modelValue.concat(props.arrayValue))\n      }\n      return\n    }\n\n    if (props.indeterminate) {\n      if (isIndeterminate.value) {\n        valueComputed.value = props.trueValue\n      } else if (isChecked.value) {\n        valueComputed.value = props.falseValue\n      } else {\n        // unchecked\n        valueComputed.value = props.indeterminateValue\n      }\n      return\n    }\n\n    if (isChecked.value) {\n      valueComputed.value = props.falseValue\n    } else {\n      valueComputed.value = props.trueValue\n    }\n  }\n\n  return {\n    isChecked,\n    isIndeterminate,\n    onBlur,\n    onFocus,\n    toggleSelection,\n    reset,\n    focus,\n    computedError,\n    computedErrorMessages,\n  }\n}\n"],"names":["useSelectableProps","useStatefulProps","useLoadingProps","useValidationProps","arrayValue","type","default","label","String","leftLabel","Boolean","trueValue","falseValue","indeterminate","indeterminateValue","disabled","readonly","useSelectableEmits","useValidationEmits","useSelectable","props","emit","input","container","values","push","Set","size","length","Error","checkDuplicates","reset","focus","_a","value","computedError","computedErrorMessages","validate","useValidation","valueComputed","useStateful","isFocused","useFocus","isIndeterminate","computed","modelIsArray","isChecked","modelValue","includes","onBlur","event","element","target","relatedTarget","onFocus","toggleSelection","loading","Array","isArray","filter","option","concat"],"mappings":"sLAyBa,MAAAA,EAAqB,IAC7BC,KACAC,KACAC,EACHC,WAAY,CAAEC,KAAM,KAAkCC,QAAS,MAC/DC,MAAO,CAAEF,KAAMG,OAAQF,QAAS,IAChCG,UAAW,CAAEJ,KAAMK,QAASJ,SAAS,GACrCK,UAAW,CAAEN,KAAM,KAAkCC,SAAS,GAC9DM,WAAY,CAAEP,KAAM,KAAkCC,SAAS,GAC/DO,cAAe,CAAER,KAAMK,QAASJ,SAAS,GACzCQ,mBAAoB,CAAET,KAAM,KAAkCC,QAAS,MACvES,SAAU,CAAEV,KAAMK,QAASJ,SAAS,GACpCU,SAAU,CAAEX,KAAMK,QAASJ,SAAS,IAGzBW,EAAqB,IAAIC,EAAoB,oBAAqB,QAAS,QAiB3EC,cAAgB,CAC3BC,EACAC,GACEC,MAAAA,EAAOf,MAAAA,EAAOgB,UAAAA,MAlBM,CAACH,IAEvB,MAAMI,EAAoB,CAACJ,EAAMR,WAAYQ,EAAMT,WAQnD,GANIS,EAAMP,eACRW,EAAOC,KAAKL,EAAMN,oBAGE,IAAIY,IAAIF,GAAQG,OAASH,EAAOI,OAGpD,MAAM,IAAIC,MAAM,kHASlBC,CAAgBV,GAGhB,MAAMW,MAAQ,IAAMV,EAAK,qBAAqB,GACxCW,MAAQ,WAAM,OAAa,QAAbC,EAAAX,EAAMY,aAAO,IAAAD,OAAA,EAAAA,EAAAD,UAE3BG,cAAEA,EAAaC,sBAAEA,EAAqBC,SAAEA,GAAaC,EAAclB,EAAOC,EAAMU,MAAOC,QACvFO,cAAEA,GAAkBC,EAAYpB,EAAOC,IACvCoB,UAAEA,GAAcC,IAkBhBC,EAAkBC,GAAS,MAAQxB,EAAMP,eAAiB0B,EAAcL,QAAUd,EAAMN,qBACxF+B,EAAeD,GAAS,IAA2B,OAArBxB,EAAMhB,aACpC0C,EAAYF,GAAS,WACzB,OAAIC,EAAaX,MACuB,QAA/BD,EAACb,EAAM2B,kBAAwB,IAAAd,OAAA,EAAAA,EAAEe,SAAS5B,EAAMhB,YAGlDmC,EAAcL,QAAUd,EAAMT,aAwCvC,MAAO,CACLmC,UAAAA,EACAH,gBAAAA,EACAM,OA/DcC,IAHS,IAACC,EAInB7B,EAAMY,QAAUgB,EAAME,SAJHD,EAIgCD,EAAMG,gBAH1C,CAAC9C,EAAM2B,MAAOX,EAAUW,OAAOc,SAASG,KAI1DV,EAAUP,OAAQ,EAClBC,EAAcD,OAAQ,EACtBG,IACAhB,EAAK,OAAQ6B,KA2DfI,QAxDeJ,IACfT,EAAUP,OAAQ,EAClBb,EAAK,QAAS6B,IAuDdK,gBA3CsB,KAClBnC,EAAMJ,UAAYI,EAAML,UAAYK,EAAMoC,UAK1CX,EAAaX,MACVd,EAAM2B,WAECU,MAAMC,QAAQtC,EAAM2B,YAErB3B,EAAM2B,WAAWC,SAAS5B,EAAMhB,YACzCiB,EAAK,oBAAqBD,EAAM2B,WAAWY,QAAQC,GAAWA,IAAWxC,EAAMhB,cAE/EiB,EAAK,oBAAqBD,EAAM2B,WAAWc,OAAOzC,EAAMhB,aAJxDiB,EAAK,oBAAqBD,EAAM2B,aAAe3B,EAAMhB,WAAa,GAAK,CAACgB,EAAM2B,WAAY3B,EAAMhB,aAFhGiB,EAAK,oBAAqB,CAACD,EAAMhB,aAWjCgB,EAAMP,cACJ8B,EAAgBT,MAClBK,EAAcL,MAAQd,EAAMT,UACnBmC,EAAUZ,MACnBK,EAAcL,MAAQd,EAAMR,WAG5B2B,EAAcL,MAAQd,EAAMN,mBAK5BgC,EAAUZ,MACZK,EAAcL,MAAQd,EAAMR,WAE5B2B,EAAcL,MAAQd,EAAMT,YAU9BoB,MAAAA,MACAC,MAAAA,MACAG,cAAAA,EACAC,sBAAAA"}